<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>KnowMal - ë¬¸ì„œ ì•…ì„± ì½”ë“œ íƒì§€ ë¦¬í¬íŠ¸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ›¡ï¸</text></svg>">
  <link rel="stylesheet" href="/static/css/report.css">
</head>
<body>
  {% if data.analysis_report or data.virustotal or data.ai_prediction %}
  
      <!-- í†µí•© íŒŒì¼ ì •ë³´ ì¹´ë“œ -->
      <div class="unified-file-card">
    <!-- ë¸Œëœë”© í—¤ë” -->
        <div class="card-header-section">
        <div class="service-branding">
            <div class="service-logo">
              <img src="/static/images/KnowMal_logo.png" alt="KnowMal" class="logo-image">
            </div>
            <div class="service-info">
                <h1 class="service-name">KnowMal</h1>
                <p class="service-tagline">ë¬¸ì„œ ì•…ì„± ì½”ë“œ íƒì§€ ì„œë¹„ìŠ¤</p>
            </div>
        </div>
        <div class="powered-by">
            <span>Powered by AI_Know</span>
          </div>
        </div>

        <!-- ì••ì¶• íŒŒì¼ ì •ë³´ ì¹´ë“œ -->      
        {% set embedded_files = (data.analysis_report.embedded_files if data.analysis_report and data.analysis_report.embedded_files else []) %}
        {% set is_archive = (data.analysis_report.file.is_archive if data.analysis_report and data.analysis_report.file and data.analysis_report.file.is_archive else False) %}
        
        {% if is_archive and embedded_files and embedded_files|length > 0 and data.analysis_report.features.structure %}
        <div class="file-card" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 1px solid #e2e8f0; margin-bottom: 20px;">
          <div style="padding: 24px;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
              <div>
                <h3 style="font-weight: 700; color: #475569; font-size: 18px; margin: 0 0 8px 0;">ğŸ“¦ ì••ì¶• íŒŒì¼ ì •ë³´</h3>
                <span style="font-size: 13px; color: #64748b; background: #e2e8f0; padding: 4px 10px; border-radius: 6px; display: inline-block;">{{ data.analysis_report.features.structure.container_type.upper() }} í¬ë§·</span>
              </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
              <div style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 16px;">
                <div style="color: #64748b; font-size: 13px; margin-bottom: 6px;">ì••ì¶• íŒŒì¼ëª…</div>
                <div style="color: #334155; font-weight: 600; font-size: 15px; word-break: break-all;">{{ data.filename }}</div>
              </div>
              
              <div style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 16px;">
                <div style="color: #64748b; font-size: 13px; margin-bottom: 6px;">ë‚´ë¶€ íŒŒì¼ ìˆ˜</div>
                <div style="color: #334155; font-weight: 600; font-size: 15px;">{{ embedded_files|length }}ê°œ</div>
              </div>
              
              {% if data.analysis_report.features.structure.malicious_files_count %}
              <div style="background: #ffffff; border: 1px solid #fca5a5; border-radius: 8px; padding: 16px;">
                <div style="color: #64748b; font-size: 13px; margin-bottom: 6px;">ì•…ì„± íŒŒì¼ ìˆ˜</div>
                <div style="color: #dc2626; font-weight: 700; font-size: 15px;">{{ data.analysis_report.features.structure.malicious_files_count }}ê°œ</div>
              </div>
              {% endif %}
              
              {% if data.analysis_report.risk_assessment.overall_risk_score %}
              <div style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 16px;">
                <div style="color: #64748b; font-size: 13px; margin-bottom: 6px;">ì „ì²´ ìœ„í—˜ë„</div>
                {% set risk_score = data.analysis_report.risk_assessment.overall_risk_score %}
                {% if risk_score > 0.5 %}
                  {% set risk_color_class = 'text-danger' %}
                {% elif risk_score > 0.1 %}
                  {% set risk_color_class = 'text-warning' %}
                {% else %}
                  {% set risk_color_class = 'text-safe' %}
                {% endif %}
                <div class="risk-percentage {{ risk_color_class }}">{{ "%.1f"|format(risk_score * 100) }}%</div>
              </div>
              {% endif %}
            </div>
            
            <!-- ì•…ì„± íŒŒì¼ ëª©ë¡ í‘œì‹œ -->
            {% if data.analysis_report.features.structure.malicious_files_count and data.analysis_report.features.structure.malicious_files_count > 0 %}
            <div style="margin-top: 20px; padding: 16px; background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px;">
              <div style="color: #dc2626; font-weight: 600; font-size: 14px; margin-bottom: 12px;">âš ï¸ ë°œê²¬ëœ ì•…ì„± íŒŒì¼</div>
              <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                <span style="background: #dc2626; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">{{ data.filename }}</span>
              </div>
            </div>
            {% endif %}
          </div>
        </div>
        {% endif %}

        <!-- íŒŒì¼ ì •ë³´ ì¹´ë“œ -->
        <div class="file-card">
      {% set embedded_files = (data.analysis_report.embedded_files if data.analysis_report and data.analysis_report.embedded_files else []) %}
      {% set is_archive = (data.analysis_report.file.is_archive if data.analysis_report and data.analysis_report.file and data.analysis_report.file.is_archive else False) %}
      {% set virustotal = data.virustotal %}
      {% if not virustotal and data.analysis_report and data.analysis_report.virustotal %}
        {% set virustotal = data.analysis_report.virustotal %}
      {% endif %}
      
      {% set ai_has_threat = false %}
      {% set ai_threats = [] %}
      {% set ai_is_normal = false %}
      {% if data.ai_prediction and data.ai_prediction.ai_analysis %}
        {% set predicted_types = data.ai_prediction.ai_analysis.predicted_types %}
        {% if predicted_types %}
          {% set dangerous_types = [] %}
          {% for threat in predicted_types %}
            {% if threat != 'Normal' %}
              {% set _ = dangerous_types.append(threat) %}
            {% else %}
              {% set ai_is_normal = true %}
            {% endif %}
          {% endfor %}
          {% if dangerous_types %}
            {% set ai_has_threat = true %}
            {% set ai_threats = dangerous_types %}
          {% endif %}
        {% endif %}
      {% endif %}
      
      {% set vt_detection_rate = 0 %}
      {% set vt_malicious_count = 0 %}
      {% set vt_total_scans = 0 %}
      {% if virustotal and virustotal.available %}
        {% set scan_summary = virustotal.scan_summary %}
        {% set vt_detection_rate = (scan_summary.detection_rate or 0)|float %}
        {% set vt_malicious_count = scan_summary.malicious or 0 %}
        {% set vt_total_scans = scan_summary.total or 0 %}
      {% endif %}

      {% set original_archive_filename = data.filename %}
      {% set display_filename = data.filename %}
      {% set display_size = data.size_bytes %}
      {% set display_sha = data.sha256 %}
      {% set display_mime = data.mime_type %}
      {% if is_archive and embedded_files and embedded_files|length > 0 %}
        {% set selected = None %}
        {% set best_rate = -1 %}
        {% for item in embedded_files %}
          {% set rep = item.report %}
          {% if rep and rep.virustotal and rep.virustotal.scan_summary %}
            {% set _sum = rep.virustotal.scan_summary %}
            {% set _total = (_sum.total or 0) %}
            {% set _mal = (_sum.malicious or 0) %}
            {% set _rate = (_mal / _total) if _total > 0 else 0 %}
            {% if _rate > best_rate %}
              {% set selected = item %}
              {% set best_rate = _rate %}
            {% endif %}
          {% endif %}
        {% endfor %}
        {% if not selected %}
          {% set best_ai = -1 %}
          {% for item in embedded_files %}
            {% set rep = item.report %}
            {% set cnt = 0 %}
            {% if rep and rep.ai_prediction and rep.ai_prediction.ai_analysis and rep.ai_prediction.ai_analysis.predicted_types %}
              {% for t in rep.ai_prediction.ai_analysis.predicted_types %}
                {% if t != 'Normal' %}{% set cnt = cnt + 1 %}{% endif %}
              {% endfor %}
            {% endif %}
            {% if cnt > best_ai %}
              {% set selected = item %}
              {% set best_ai = cnt %}
            {% endif %}
          {% endfor %}
        {% endif %}
        {% if not selected %}
          {% set selected = embedded_files[0] %}
        {% endif %}
        {% set rep = selected.report %}
        {% if rep and rep.file %}
          {% set display_filename = selected.filename or rep.file.filename or data.filename %}
          {% set display_size = selected.size_bytes or rep.file.size_bytes or data.size_bytes %}
          {% set display_sha = (rep.file.hash.sha256 if rep.file.hash else data.sha256) %}
          {% set display_mime = rep.file.mime_type or data.mime_type %}
        {% else %}
          {% set display_filename = selected.filename or data.filename %}
          {% set display_size = selected.size_bytes or data.size_bytes %}
        {% endif %}
      {% endif %}
      
      {% if is_archive and embedded_files and embedded_files|length > 0 %}
        {% set agg = namespace(max_rate=0.0, child_vt=None, ai_types=[]) %}
        {% for item in embedded_files %}
          {% set rep = item.report %}
          {% if rep and rep.virustotal and rep.virustotal.scan_summary %}
            {% set _sum = rep.virustotal.scan_summary %}
            {% set _total = (_sum.total or 0) %}
            {% set _mal = (_sum.malicious or 0) %}
            {% set _rate = (_mal / _total * 100) if _total > 0 else 0 %}
            {% if _rate > agg.max_rate %}
              {% set agg.max_rate = _rate %}
              {% set agg.child_vt = rep.virustotal %}
            {% endif %}
          {% endif %}
          {% if rep and rep.ai_prediction and rep.ai_prediction.ai_analysis and rep.ai_prediction.ai_analysis.predicted_types %}
            {% for t in rep.ai_prediction.ai_analysis.predicted_types %}
              {% if t != 'Normal' and t not in agg.ai_types %}
                {% set _ = agg.ai_types.append(t) %}
              {% endif %}
            {% endfor %}
          {% endif %}
        {% endfor %}

        {% if agg.child_vt %}
          {% set virustotal = agg.child_vt %}
          {% set scan_summary = virustotal.scan_summary %}
          {% set vt_detection_rate = (scan_summary.detection_rate or ((scan_summary.malicious or 0) / (scan_summary.total or 1) * 100))|float %}
          {% set vt_malicious_count = scan_summary.malicious or 0 %}
          {% set vt_total_scans = scan_summary.total or 0 %}
        {% endif %}

        {% if agg.ai_types and agg.ai_types|length > 0 %}
          {% set ai_has_threat = true %}
          {% set ai_threats = agg.ai_types %}
        {% elif not ai_has_threat %}
          {% set ai_threats = [] %}
        {% endif %}

        {% if not ai_has_threat and vt_malicious_count > 0 %}
          {% set ai_has_threat = true %}
        {% endif %}
      {% endif %}

      {% if ai_has_threat %}
          <div class="malicious-file-layout">
            {% if false %}
            {% set embedded_vt_dangerous = 0 %}
            {% set embedded_ai_dangerous = 0 %}
            {% for item in embedded_files %}
              {% set rep = item.report %}
              {% if rep and rep.virustotal and rep.virustotal.scan_summary and rep.virustotal.scan_summary.malicious > 0 %}
                {% set embedded_vt_dangerous = embedded_vt_dangerous + 1 %}
              {% endif %}
              {% if rep and rep.ai_prediction and rep.ai_prediction.ai_analysis and rep.ai_prediction.ai_analysis.predicted_types %}
                {% set has_dangerous_ai = false %}
                {% for threat in rep.ai_prediction.ai_analysis.predicted_types %}
                  {% if threat != 'Normal' and not has_dangerous_ai %}
                    {% set embedded_ai_dangerous = embedded_ai_dangerous + 1 %}
                    {% set has_dangerous_ai = true %}
                  {% endif %}
                {% endfor %}
              {% endif %}
            {% endfor %}
            
            {% if embedded_vt_dangerous > 0 or embedded_ai_dangerous > 0 %}
            <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid #f59e0b; border-radius: 12px; padding: 20px; margin: 0 0 24px 0; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.15);">
              <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                <div style="font-size: 24px;">ğŸ“¦</div>
                <div>
                  <div style="font-weight: 700; font-size: 18px; color: #92400e; margin-bottom: 4px;">
                    ZIP ì••ì¶• íŒŒì¼ì€ ì •ìƒì´ê³  ë‚´ë¶€ íŒŒì¼ ê²€ì‚¬í–ˆë”ë‹ˆ ë‹¤ìŒê³¼ ê°™ì€ ê²°ê³¼ê°€ ë³´ì…ë‹ˆë‹¤
                  </div>
                  <div style="font-size: 14px; color: #a16207;">
                    ì••ì¶• íŒŒì¼ ìì²´ëŠ” ì•ˆì „í•˜ì§€ë§Œ, ë‚´ë¶€ì— í¬í•¨ëœ {{ embedded_files|length }}ê°œ íŒŒì¼ ì¤‘ ìœ„í—˜í•œ íŒŒì¼ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.
                  </div>
                </div>
              </div>
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-top: 12px;">
                {% if embedded_vt_dangerous > 0 %}
                <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid #fca5a5; border-radius: 8px; padding: 12px;">
                  <div style="font-weight: 600; color: #dc2626; font-size: 14px;">VirusTotal íƒì§€</div>
                  <div style="font-size: 16px; font-weight: 700; color: #dc2626;">{{ embedded_vt_dangerous }}ê°œ íŒŒì¼</div>
                </div>
                {% endif %}
                {% if embedded_ai_dangerous > 0 %}
                <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid #fbbf24; border-radius: 8px; padding: 12px;">
                  <div style="font-weight: 600; color: #f59e0b; font-size: 14px;">AI ìœ„í—˜ ì˜ˆì¸¡</div>
                  <div style="font-size: 16px; font-weight: 700; color: #f59e0b;">{{ embedded_ai_dangerous }}ê°œ íŒŒì¼</div>
                </div>
                {% endif %}
              </div>
            </div>
            {% endif %}
            {% endif %}
            
            <!-- ìƒë‹¨: ì›í˜• ê·¸ë˜í”„ + íŒŒì¼ ì •ë³´ -->
            <div class="file-analysis-header">
              <!-- ì™¼ìª½: ì›í˜• ê·¸ë˜í”„ (VirusTotal ê²°ê³¼) -->
              <div class="virus-total-circle">
                <div class="circular-progress" data-percentage="{{ vt_detection_rate|round(1) }}">
                  <svg class="progress-ring" width="140" height="140">
                    <defs>
                      <linearGradient id="dangerGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#ef4444;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#dc2626;stop-opacity:1" />
                      </linearGradient>
                    </defs>
                    <!-- ë°°ê²½ íŠ¸ë™ (ì—°í•œ íšŒìƒ‰ ì›) -->
                    <circle class="progress-ring-track" cx="70" cy="70" r="60" stroke="#f3f4f6" stroke-width="12" fill="transparent"/>
                    <!-- ì§„í–‰ ìƒíƒœ í˜¸ (ë¹¨ê°„ìƒ‰, í¼ì„¼íŠ¸ì— ë”°ë¼ ì±„ì›Œì§) -->
                    <circle class="progress-ring-fill" cx="70" cy="70" r="60" fill="transparent" stroke-width="12" stroke-linecap="round"
                            stroke="url(#dangerGradient)" 
                            stroke-dasharray="377 377" 
                            stroke-dashoffset="{{ 377 - (vt_detection_rate * 377 / 100) }}"
                            transform="rotate(-90 70 70)"/>
                  </svg>
                  <div class="progress-text">
                    <div class="progress-status malicious-status">Malicious</div>
                  </div>
                </div>
                <div class="progress-details">
                  <div class="progress-description">íƒì§€í•œ ë³´ì•ˆ íšŒì‚¬</div>
                  <div class="progress-count">{{ vt_malicious_count }}/{{ vt_total_scans }}ê°œ</div>
                  <div class="progress-percentage">{{ vt_detection_rate|round(1) }}%</div>
                </div>
              </div>
              
              <!-- ì˜¤ë¥¸ìª½: íŒŒì¼ ì •ë³´ -->
              <div class="file-info-section">
                <div class="file-info-item">
                  <div class="info-label">íŒŒì¼ëª…</div>
                  <div class="info-value">{{ display_filename }}</div>
                </div>
                <div class="file-info-item">
                  <div class="info-label">í¬ê¸°</div>
                  <div class="info-value">{{ (display_size / 1024 / 1024)|round(1) }} MB</div>
                </div>
                <div class="file-info-item">
                  <div class="info-label">SHA-256</div>
                  <div class="info-value">{{ (display_sha[:8] + '...' + display_sha[-4:]) if display_sha else 'unknown' }}</div>
                </div>
                <div class="file-info-item">
                  <div class="info-label">ë¬¸ì„œ ìœ í˜•</div>
                  {% set mime_type = display_mime or "ì•Œ ìˆ˜ ì—†ìŒ" %}
                  {% set friendly_type = "ì•Œ ìˆ˜ ì—†ìŒ" %}
                  {% if mime_type.startswith('application/msword') or mime_type.startswith('application/vnd.openxmlformats-officedocument.wordprocessingml') %}
                    {% set friendly_type = "Word ë¬¸ì„œ" %}
                  {% elif mime_type.startswith('application/vnd.ms-excel') or mime_type.startswith('application/vnd.openxmlformats-officedocument.spreadsheetml') %}
                    {% set friendly_type = "Excel ë¬¸ì„œ" %}
                  {% elif mime_type.startswith('application/vnd.ms-powerpoint') or mime_type.startswith('application/vnd.openxmlformats-officedocument.presentationml') %}
                    {% set friendly_type = "PowerPoint ë¬¸ì„œ" %}
                  {% elif mime_type.startswith('application/pdf') %}
                    {% set friendly_type = "PDF ë¬¸ì„œ" %}
                  {% elif mime_type.startswith('text/') %}
                    {% set friendly_type = "í…ìŠ¤íŠ¸ íŒŒì¼" %}
                  {% elif mime_type.startswith('image/') %}
                    {% set friendly_type = "ì´ë¯¸ì§€ íŒŒì¼" %}
                  {% elif mime_type.startswith('video/') %}
                    {% set friendly_type = "ë™ì˜ìƒ íŒŒì¼" %}
                  {% elif mime_type.startswith('audio/') %}
                    {% set friendly_type = "ì˜¤ë””ì˜¤ íŒŒì¼" %}
                  {% elif mime_type.startswith('application/zip') or mime_type.startswith('application/x-rar') %}
                    {% set friendly_type = "ì••ì¶• íŒŒì¼" %}
                  {% elif mime_type.startswith('application/') %}
                    {% set friendly_type = "ì‘ìš© í”„ë¡œê·¸ë¨" %}
                  {% else %}
                    {% set friendly_type = mime_type %}
                  {% endif %}
                  <div class="info-value">{{ friendly_type }}</div>
                </div>
              </div>
            </div>
            
            <!-- êµ¬ë¶„ì„  -->
            <div class="section-divider"></div>
            
            <!-- í•˜ë‹¨: ì•¡ì…˜ ë²„íŠ¼ -->
            <div class="file-actions-and-tags">
              <div class="action-buttons">
                {% for threat in ai_threats %}
                  <button class="action-button malicious-button">{{ threat }}</button>
                {% endfor %}
              </div>
            </div>
            
            <!-- ìœ„í—˜ íƒœê·¸ë“¤ -->
            {% set all_tags = [] %}
            {% for threat in ai_threats %}
              {% if threat == 'Download' %}
                {% set _ = all_tags.append({'text': 'ì¶”ê°€ ì•…ì„±ì½”ë“œ ì„¤ì¹˜', 'class': 'dot-red'}) %}
              {% elif threat == 'Backdoor' %}
                {% set _ = all_tags.append({'text': 'ì›ê²© ì œì–´', 'class': 'dot-orange'}) %}
                {% set _ = all_tags.append({'text': 'ë°ì´í„° íƒˆì·¨ ê°€ëŠ¥', 'class': 'dot-purple'}) %}
              {% elif threat == 'Botnet' %}
                {% set _ = all_tags.append({'text': 'DDoS ê³µê²©', 'class': 'dot-yellow'}) %}
                {% set _ = all_tags.append({'text': 'ìŠ¤íŒ¸ ë°œì†¡', 'class': 'dot-blue'}) %}
                {% set _ = all_tags.append({'text': 'ì•”í˜¸í™”í ì±„êµ´', 'class': 'dot-green'}) %}
              {% elif threat == 'Infiltration' %}
                {% set _ = all_tags.append({'text': 'ë°ì´í„° ìœ ì¶œ', 'class': 'dot-red'}) %}
                {% set _ = all_tags.append({'text': 'ì‹œìŠ¤í…œ íŒŒê´´', 'class': 'dot-orange'}) %}
                {% set _ = all_tags.append({'text': 'ê°œì¸ì •ë³´ ì¹¨í•´', 'class': 'dot-purple'}) %}
              {% else %}
                {% set _ = all_tags.append({'text': threat, 'class': 'dot-gray'}) %}
              {% endif %}
            {% endfor %}
            
            <!-- íƒœê·¸ ì»¨í…Œì´ë„ˆ -->
            <div class="threat-tags">
              <!-- ëª¨ë“  íƒœê·¸ë¥¼ 4ê°œì”© ì¤„ë°”ê¿ˆí•˜ì—¬ í‘œì‹œ -->
              {% for tag_row in all_tags|batch(4) %}
                <div class="threat-tags-row">
                  {% for tag in tag_row %}
                    <div class="threat-tag gray-tag {{ tag.class }}">
                      <span class="tag-text">{{ tag.text }}</span>
                    </div>
                  {% endfor %}
                </div>
              {% endfor %}
            </div>
          </div>
      {% else %}
          <!-- ì •ìƒ íŒŒì¼ ë ˆì´ì•„ì›ƒ  -->
          <div class="normal-file-layout">
            <!-- ì•„ì¹´ì´ë¸Œ íŒŒì¼ ì•ˆë‚´ (ë‚´ë¶€ íŒŒì¼ ìœ„í—˜ë„ í‘œì‹œ) -->
            {% if is_archive and embedded_files and embedded_files|length > 0 %}
            {% set embedded_vt_dangerous = 0 %}
            {% set embedded_ai_dangerous = 0 %}
            {% for item in embedded_files %}
              {% set rep = item.report %}
              {% if rep and rep.virustotal and rep.virustotal.scan_summary and rep.virustotal.scan_summary.malicious > 0 %}
                {% set embedded_vt_dangerous = embedded_vt_dangerous + 1 %}
              {% endif %}
              {% if rep and rep.ai_prediction and rep.ai_prediction.ai_analysis and rep.ai_prediction.ai_analysis.predicted_types %}
                {% set has_dangerous_ai = false %}
                {% for threat in rep.ai_prediction.ai_analysis.predicted_types %}
                  {% if threat != 'Normal' and not has_dangerous_ai %}
                    {% set embedded_ai_dangerous = embedded_ai_dangerous + 1 %}
                    {% set has_dangerous_ai = true %}
                  {% endif %}
                {% endfor %}
              {% endif %}
            {% endfor %}
            
            {% if embedded_vt_dangerous > 0 or embedded_ai_dangerous > 0 %}
            <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid #f59e0b; border-radius: 12px; padding: 20px; margin: 0 0 24px 0; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.15);">
              <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                <div style="font-size: 24px;">ğŸ“¦</div>
                <div>
                  <div style="font-weight: 700; font-size: 18px; color: #92400e; margin-bottom: 4px;">
                    ZIP ì••ì¶• íŒŒì¼ì€ ì •ìƒì´ê³  ë‚´ë¶€ íŒŒì¼ ê²€ì‚¬í–ˆë”ë‹ˆ ë‹¤ìŒê³¼ ê°™ì€ ê²°ê³¼ê°€ ë³´ì…ë‹ˆë‹¤
                  </div>
                  <div style="font-size: 14px; color: #a16207;">
                    ì••ì¶• íŒŒì¼ ìì²´ëŠ” ì•ˆì „í•˜ì§€ë§Œ, ë‚´ë¶€ì— í¬í•¨ëœ {{ embedded_files|length }}ê°œ íŒŒì¼ ì¤‘ ìœ„í—˜í•œ íŒŒì¼ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.
                  </div>
                </div>
              </div>
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-top: 12px;">
                {% if embedded_vt_dangerous > 0 %}
                <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid #fca5a5; border-radius: 8px; padding: 12px;">
                  <div style="font-weight: 600; color: #dc2626; font-size: 14px;">VirusTotal íƒì§€</div>
                  <div style="font-size: 16px; font-weight: 700; color: #dc2626;">{{ embedded_vt_dangerous }}ê°œ íŒŒì¼</div>
                </div>
                {% endif %}
                {% if embedded_ai_dangerous > 0 %}
                <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid #fbbf24; border-radius: 8px; padding: 12px;">
                  <div style="font-weight: 600; color: #f59e0b; font-size: 14px;">AI ìœ„í—˜ ì˜ˆì¸¡</div>
                  <div style="font-size: 16px; font-weight: 700; color: #f59e0b;">{{ embedded_ai_dangerous }}ê°œ íŒŒì¼</div>
                </div>
                {% endif %}
              </div>
            </div>
            {% endif %}
            {% endif %}
            
            <!-- ìƒë‹¨: ì›í˜• ê·¸ë˜í”„ + íŒŒì¼ ì •ë³´ -->
            <div class="file-analysis-header">
              <!-- ì™¼ìª½: ì›í˜• ê·¸ë˜í”„ (VirusTotal ê²°ê³¼) -->
              <div class="virus-total-circle">
                <div class="circular-progress is-normal" data-percentage="0">
                  <svg class="progress-ring" width="140" height="140">
                    <defs>
                      <linearGradient id="safeGradient2" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#15803d;stop-opacity:0.9" />
                        <stop offset="30%" style="stop-color:#22c55e;stop-opacity:1" />
                        <stop offset="70%" style="stop-color:#16a34a;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#15803d;stop-opacity:0.9" />
                      </linearGradient>
                    </defs>
                    <circle class="progress-ring-track" cx="90" cy="90" r="75" stroke="transparent" stroke-width="18" fill="transparent"/>
                    <circle class="progress-ring-fill" cx="90" cy="90" r="75" fill="transparent" stroke-width="18" stroke-linecap="round"
                            stroke="url(#safeGradient2)" 
                            stroke-dasharray="471 471" 
                            stroke-dashoffset="0"
                            transform="rotate(-90 90 90)"/>
                  </svg>
                  <div class="progress-text">
                    <div class="progress-status normal-status">Normal</div>
                  </div>
                </div>
                <div class="progress-details" style="display: none;">
                  <div class="progress-description">ì•ˆì „í•˜ë‹¤ê³  íŒì •í•œ íšŒì‚¬</div>
                  <div class="progress-count">{{ vt_total_scans - vt_malicious_count }}/{{ vt_total_scans }}ê°œ</div>
                  <div class="progress-percentage">{{ vt_detection_rate|round(1) }}%</div>
                </div>
              </div>
              
              <!-- ì˜¤ë¥¸ìª½: íŒŒì¼ ì •ë³´ -->
              <div class="file-info-section">
                <div class="file-info-item">
                  <div class="info-label">íŒŒì¼ëª…</div>
                  <div class="info-value">{{ display_filename }}</div>
                </div>
                <div class="file-info-item">
                  <div class="info-label">í¬ê¸°</div>
                  <div class="info-value">{{ (display_size / 1024 / 1024)|round(1) }} MB</div>
                </div>
                <div class="file-info-item">
                  <div class="info-label">SHA-256</div>
                  <div class="info-value">{{ (display_sha[:8] + '...' + display_sha[-4:]) if display_sha else 'unknown' }}</div>
                </div>
                <div class="file-info-item">
                  <div class="info-label">ë¬¸ì„œ ìœ í˜•</div>
                  {% set mime_type = display_mime or "ì•Œ ìˆ˜ ì—†ìŒ" %}
                  {% set friendly_type = "ì•Œ ìˆ˜ ì—†ìŒ" %}
                  {% if mime_type.startswith('application/msword') or mime_type.startswith('application/vnd.openxmlformats-officedocument.wordprocessingml') %}
                    {% set friendly_type = "Word ë¬¸ì„œ" %}
                  {% elif mime_type.startswith('application/vnd.ms-excel') or mime_type.startswith('application/vnd.openxmlformats-officedocument.spreadsheetml') %}
                    {% set friendly_type = "Excel ë¬¸ì„œ" %}
                  {% elif mime_type.startswith('application/vnd.ms-powerpoint') or mime_type.startswith('application/vnd.openxmlformats-officedocument.presentationml') %}
                    {% set friendly_type = "PowerPoint ë¬¸ì„œ" %}
                  {% elif mime_type.startswith('application/pdf') %}
                    {% set friendly_type = "PDF ë¬¸ì„œ" %}
                  {% elif mime_type.startswith('text/') %}
                    {% set friendly_type = "í…ìŠ¤íŠ¸ íŒŒì¼" %}
                  {% elif mime_type.startswith('image/') %}
                    {% set friendly_type = "ì´ë¯¸ì§€ íŒŒì¼" %}
                  {% elif mime_type.startswith('video/') %}
                    {% set friendly_type = "ë™ì˜ìƒ íŒŒì¼" %}
                  {% elif mime_type.startswith('audio/') %}
                    {% set friendly_type = "ì˜¤ë””ì˜¤ íŒŒì¼" %}
                  {% elif mime_type.startswith('application/zip') or mime_type.startswith('application/x-rar') %}
                    {% set friendly_type = "ì••ì¶• íŒŒì¼" %}
                  {% elif mime_type.startswith('application/') %}
                    {% set friendly_type = "ì‘ìš© í”„ë¡œê·¸ë¨" %}
                  {% else %}
                    {% set friendly_type = mime_type %}
                  {% endif %}
                  <div class="info-value">{{ friendly_type }}</div>
                </div>
              </div>
            </div>
            
            <!-- êµ¬ë¶„ì„  -->
            <div class="section-divider"></div>
            
            <!-- í•˜ë‹¨: SAFE íƒœê·¸ -->
            <div class="file-actions-and-tags">
              <div class="safe-status-tag">
                <span class="safe-text">SAFE</span>
              </div>
            </div>
            
            <!-- ì•ˆì „ íƒœê·¸ë“¤ -->
            <div class="threat-tags">
              <div class="threat-tag gray-tag dot-green">
                <span class="tag-text">ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ ë¯¸í¬í•¨</span>
              </div>
              <div class="threat-tag gray-tag dot-blue">
                <span class="tag-text">ë§¤í¬ë¡œ/ì™¸ë¶€ ì½˜í…ì¸  ë¯¸ì‚¬ìš©</span>
              </div>
              <div class="threat-tag gray-tag dot-green">
                <span class="tag-text">ì‹¤í–‰ ê°€ëŠ¥í•œ ì½˜í…ì¸  ì—†ìŒ</span>
              </div>
            </div>
          </div>
      {% endif %}
        </div>
        </div>
      </div>

      <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->

      {% set prefer_vt = false %}
      {% if virustotal and virustotal.available and virustotal.scan_summary %}
        {% set prefer_vt = true %}
      {% elif is_archive and embedded_files and embedded_files|length > 0 %}
        {% for item in embedded_files %}
          {% set rep = item.report %}
          {% if rep and rep.virustotal and rep.virustotal.available and rep.virustotal.scan_summary %}
            {% set prefer_vt = true %}
          {% endif %}
        {% endfor %}
      {% endif %}
      <div class="tab-navigation">
        <button class="tab-button {{ 'active' if not prefer_vt else '' }}" data-tab="ai-analysis">
          AI ë„¤íŠ¸ì›Œí¬ í–‰ìœ„ ì˜ˆì¸¡ ê²°ê³¼
        </button>
        <button class="tab-button {{ 'active' if prefer_vt else '' }}" data-tab="virustotal">
          VirusTotal ë°”ì´ëŸ¬ìŠ¤ ê²€ì‚¬ ê²°ê³¼
        </button>
      </div>

      <!-- AI ë„¤íŠ¸ì›Œí¬ í–‰ìœ„ ì˜ˆì¸¡ íƒ­ ì½˜í…ì¸  -->
      <div id="ai-analysis-tab" class="tab-content {{ 'active' if not prefer_vt else '' }}">
        <div class="analysis-section">
          <div class="section-content">
              {% set ai_data = data %}
              
              {% if is_archive and embedded_files and embedded_files|length > 0 %}
                {% set most_dangerous = namespace(item=None, threat_count=0, has_malicious=false) %}
                
                {% for item in embedded_files %}
                  {% set rep = item.report %}
                  {% if rep and rep.ai_prediction and rep.ai_prediction.ai_analysis and rep.ai_prediction.ai_analysis.predicted_types %}
                    {% set threat_count = 0 %}
                    {% for t in rep.ai_prediction.ai_analysis.predicted_types %}
                      {% if t != 'Normal' %}
                        {% set threat_count = threat_count + 1 %}
                      {% endif %}
                    {% endfor %}
                    {% if threat_count > 0 %}
                      {% set most_dangerous.has_malicious = true %}
                      {% if threat_count > most_dangerous.threat_count %}
                        {% set most_dangerous.item = item %}
                        {% set most_dangerous.threat_count = threat_count %}
                      {% endif %}
                    {% endif %}
                  {% endif %}
                {% endfor %}
                
                {% if most_dangerous.item %}
                  {% set rep = most_dangerous.item.report %}
                  {% set ai_data = {"ai_prediction": rep.ai_prediction, "filename": most_dangerous.item.filename} %}
                {% elif most_dangerous.has_malicious == false %}
                  {# ëª¨ë“  ë‚´ë¶€ íŒŒì¼ì´ Normalì¸ ê²½ìš°, ì²« ë²ˆì§¸ íŒŒì¼ ì‚¬ìš© #}
                  {% if embedded_files and embedded_files|length > 0 %}
                    {% set first_file = embedded_files[0] %}
                    {% if first_file.report and first_file.report.ai_prediction %}
                      {% set ai_data = {"ai_prediction": first_file.report.ai_prediction, "filename": first_file.filename} %}
                    {% endif %}
                  {% endif %}
                {% endif %}
                
              {% else %}
                {# ì¼ë°˜ íŒŒì¼ì˜ ê²½ìš° ì›ë³¸ data ì‚¬ìš© #}
              {% endif %}
              
              {% if ai_data.ai_prediction and ai_data.ai_prediction.ai_analysis %}
              {% set ai_analysis = ai_data.ai_prediction.ai_analysis %}
              {% set predicted_types = ai_analysis.predicted_types %}
              {% set confidence_scores = ai_analysis.confidence_scores %}
              {% set model_classes = ai_analysis.model_classes %}
    
          <!-- ìœ„í—˜ í•­ëª© ê·¸ë£¹ -->
          {% if predicted_types %}
          <div class="prediction-group danger">
            <h3>íƒì§€ëœ ìœ„í˜‘</h3>
            {% for class_name in predicted_types %}
            <div class="prediction-item {{ 'safe' if class_name == 'Normal' else 'danger' }}">
              <div class="icon"></div>
              <div class="content">
                <div class="label">{{ class_name }}</div>
                <div class="desc">
                  {% if class_name == 'Backdoor' %}ë°±ë„ì–´ - ì›ê²© ì ‘ê·¼ ì•…ì„±ì½”ë“œ
                  {% elif class_name == 'Botnet' %}ë´‡ë„· - ë„¤íŠ¸ì›Œí¬ ì œì–´ ì•…ì„±ì½”ë“œ
                  {% elif class_name == 'Download' %}ë‹¤ìš´ë¡œë” - ì¶”ê°€ ì•…ì„±ì½”ë“œ ë‹¤ìš´ë¡œë“œ
                  {% elif class_name == 'Infiltration' %}ì¹¨íˆ¬ - ì‹œìŠ¤í…œ ì¹¨ì… ì•…ì„±ì½”ë“œ
                  {% elif class_name == 'Normal' %}ì •ìƒ - ìœ„í˜‘ì´ ê°ì§€ë˜ì§€ ì•ŠìŒ
                  {% else %}{{ class_name }} - ì•…ì„±ì½”ë“œ ìœ í˜•
                  {% endif %}
                </div>
              </div>
              <div class="status">{{ 'ì •ìƒ' if class_name == 'Normal' else 'íƒì§€ë¨' }}</div>
            </div>
            {% endfor %}
            </div>
          {% endif %}
          
          <!-- ì•ˆì „ í•­ëª© ê·¸ë£¹ -->
          {% set safe_types = ['Infiltration', 'Normal'] %}
          {% set detected_safe = [] %}
          {% for class_name in safe_types %}
            {% if class_name not in predicted_types %}
              {% set _ = detected_safe.append(class_name) %}
            {% endif %}
          {% endfor %}
          
          {% if detected_safe %}
          <div class="prediction-group safe collapsed">
            <h3>âœ… ì •ìƒ í•­ëª© ({{ detected_safe|length }}ê°œ)</h3>
            <button class="toggle-btn" onclick="toggleSafeItems()">í¼ì³ë³´ê¸° â–¼</button>
            <div class="prediction-list hidden" id="safe-items">
              {% for class_name in detected_safe %}
              <div class="prediction-item safe">
                <div class="icon">âœ…</div>
                <div class="content">
                  <div class="label">{{ class_name }}</div>
                  <div class="desc">ì •ìƒ ìƒíƒœ</div>
        </div>
                <div class="status">ì •ìƒ</div>
      </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}
          
          <div class="divider"></div>
      
      
      {% if ai_analysis.network_feature_probabilities %}
      <div class="ai-network-section">
        <h3>ğŸ“Š ë„¤íŠ¸ì›Œí¬ í™œë™ ë¶„ì„</h3>
        <div class="network-stats">
          {% set feature_names = {
            'external_session_count': 'ì™¸ë¶€ ì—°ê²° ì‹œë„',
            'http_any_external_file_download': 'íŒŒì¼ ë‹¤ìš´ë¡œë“œ',
            'http_any_request': 'HTTP ìš”ì²­',
            'dns_any_request': 'DNS ì¡°íšŒ',
            'http_hosts_count': 'í˜¸ìŠ¤íŠ¸ ì—°ê²°',
            'dns_domains_count': 'ë„ë©”ì¸ ì¡°íšŒ',
            'http_user_agents_count': 'ì‚¬ìš©ì ì—ì´ì „íŠ¸',
            'http_redirect_chain_count': 'ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²´ì¸',
            'http_download_mime_types_count': 'ë‹¤ìš´ë¡œë“œ íƒ€ì…',
            'http_methods_count': 'HTTP ë©”ì„œë“œ',
            'protocols_count': 'í”„ë¡œí† ì½œ ì‚¬ìš©'
          } %}
          
          {% set feature_icons = {
            'external_session_count': 'ğŸŒ',
            'http_any_external_file_download': 'ğŸ“¥',
            'http_any_request': 'ğŸ”—',
            'dns_any_request': 'ğŸ”',
            'http_hosts_count': 'ğŸ ',
            'dns_domains_count': 'ğŸŒ',
            'http_user_agents_count': 'ğŸ‘¤',
            'http_redirect_chain_count': 'ğŸ”„',
            'http_download_mime_types_count': 'ğŸ“„',
            'http_methods_count': 'âš¡',
            'protocols_count': 'ğŸ”§'
          } %}
          
          {% set sorted_features = [] %}
          {% for feature, probability in ai_analysis.network_feature_probabilities.items() %}
          {% if probability > 0.1 %}  
              {% set _ = sorted_features.append((feature, probability)) %}
            {% endif %}
          {% endfor %}
          {% set sorted_features = sorted_features|sort(attribute=1, reverse=true) %}
          
          {% for feature, probability in sorted_features[:5] %}
          {% set prob_percent = (probability * 100)|round(1) if probability <= 1 else probability|round(1) %}
          {% if prob_percent > 100 %}
            {% set prob_percent = 100 %}
          {% endif %}
          {% set risk_level = 'high' if prob_percent > 60 else 'medium' if prob_percent > 30 else 'low' %}
          <div class="stat-item {{ risk_level }}">
            <div class="stat-header">
              <span class="stat-icon">{{ feature_icons.get(feature, 'ğŸ“Š') }}</span>
              <span class="stat-name">{{ feature_names.get(feature, feature) }}</span>
              <span class="stat-value">{{ prob_percent }}%</span>
            </div>
            <div class="stat-bar">
              <div class="stat-fill {{ risk_level }}" data-width="{{ prob_percent }}"></div>
            </div>
            <div class="stat-desc">{{ feature }}</div>
          </div>
          {% endfor %}
          
          {% if sorted_features|length > 5 %}
          <button class="show-all-btn" onclick="toggleAllStats()">ì „ì²´ í†µê³„ ë³´ê¸° ({{ sorted_features|length }}ê°œ) â–¼</button>
          <div class="additional-stats hidden" id="additional-stats">
            {% for feature, probability in sorted_features[5:] %}
            {% set prob_percent = (probability * 100)|round(1) if probability <= 1 else probability|round(1) %}
            {% if prob_percent > 100 %}
              {% set prob_percent = 100 %}
            {% endif %}
            {% set risk_level = 'high' if prob_percent > 60 else 'medium' if prob_percent > 30 else 'low' %}
            <div class="stat-item {{ risk_level }}">
              <div class="stat-header">
                <span class="stat-icon">{{ feature_icons.get(feature, 'ğŸ“Š') }}</span>
                <span class="stat-name">{{ feature_names.get(feature, feature) }}</span>
                <span class="stat-value">{{ prob_percent }}%</span>
              </div>
              <div class="stat-bar">
                <div class="stat-fill {{ risk_level }}" data-width="{{ prob_percent }}"></div>
              </div>
              <div class="stat-desc">{{ feature }}</div>
            </div>
            {% endfor %}
          </div>
          {% endif %}
      {% endif %}
      
      <div class="ai-footer">
        <div class="ai-disclaimer">
          ğŸ’¡ <strong>AI ë¶„ì„ ì•ˆë‚´:</strong> ì´ ê²°ê³¼ëŠ” ê¸°ê³„í•™ìŠµ ëª¨ë¸ì— ê¸°ë°˜í•œ ì˜ˆì¸¡ì…ë‹ˆë‹¤. 
          ì‹¤ì œ ì•…ì„±ì½”ë“œ ì—¬ë¶€ëŠ” ì „ë¬¸ ë³´ì•ˆ ë„êµ¬ë¥¼ í†µí•´ í™•ì¸í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
              </div>
            </div>
              {% else %}
              <div class="no-data-message">
                <div class="no-data-icon">ğŸ¤–</div>
                <div class="no-data-text">
                  {% if is_archive and embedded_files and embedded_files|length > 0 %}
                    ì••ì¶• íŒŒì¼ ë‚´ë¶€ íŒŒì¼ë“¤ì˜ AI ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
                  {% else %}
                    AI ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
                  {% endif %}
                </div>
              </div>
              {% endif %}
          </div>
        </div>
      </div>

      <!-- VirusTotal ë°”ì´ëŸ¬ìŠ¤ ê²€ì‚¬ ê²°ê³¼ íƒ­ ì½˜í…ì¸  -->
      <div id="virustotal-tab" class="tab-content {{ 'active' if prefer_vt else '' }}">
        <div class="analysis-section vt-section">
          <div class="section-content">
            {#
              ì•„ì¹´ì´ë¸Œì¼ ë•ŒëŠ” ë‚´ë¶€ íŒŒì¼ì˜ VT ê²°ê³¼ë¥¼ ì§ì ‘ ë³´ì—¬ì¤€ë‹¤.
              - ê°€ì¥ ë†’ì€ íƒì§€ìœ¨ì„ ê°€ì§„ ë‚´ë¶€ íŒŒì¼ì„ ì„ íƒí•˜ë©°, íŒŒì¼ëª…ë„ í•¨ê»˜ ì¶”ì í•œë‹¤.
              - ì•„ì¹´ì´ë¸Œê°€ ì•„ë‹ˆë©´ ì„œë²„ê°€ ì „ë‹¬í•œ virustotal ì‚¬ìš©.
            #}
            {# ìƒë‹¨ì—ì„œ ê³„ì‚°ëœ virustotal(ë‚´ë¶€ íŒŒì¼ ì§‘ê³„)ì„ ìš°ì„  ì‚¬ìš© #}
            {% set vt_display = virustotal %}
            {% set vt_filename = display_filename if display_filename else data.filename %}
            {% if is_archive and embedded_files and embedded_files|length > 0 %}
              {% if not vt_display or not vt_display.scan_summary %}
                {% set most_dangerous_vt = namespace(item=None, rate=0, has_vt_data=false) %}
                {% for item in embedded_files %}
                  {% set rep = item.report %}
                  {% if rep and rep.virustotal and rep.virustotal.available and rep.virustotal.scan_summary %}
                    {% set most_dangerous_vt.has_vt_data = true %}
                    {% set vt_summary = rep.virustotal.scan_summary %}
                    {% set vt_malicious = (vt_summary.malicious or 0) %}
                    {% set vt_total = (vt_summary.total or 0) %}
                    {% set vt_rate = (vt_malicious / vt_total * 100) if vt_total > 0 else 0 %}
                    {% if vt_rate > most_dangerous_vt.rate %}
                      {% set most_dangerous_vt.item = item %}
                      {% set most_dangerous_vt.rate = vt_rate %}
                    {% endif %}
                  {% endif %}
                {% endfor %}
                {% if most_dangerous_vt.item %}
                  {% set rep = most_dangerous_vt.item.report %}
                  {% set vt_display = rep.virustotal %}
                  {% set vt_filename = most_dangerous_vt.item.filename %}
                {% else %}
                  {# VT ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ íŒŒì¼ ì‹œë„ #}
                  {% set first_file = embedded_files[0] %}
                  {% if first_file.report and first_file.report.virustotal %}
                    {% set vt_display = first_file.report.virustotal %}
                    {% set vt_filename = first_file.filename %}
                  {% endif %}
                {% endif %}
              {% endif %}
            {% else %}
              {% set vt_display = virustotal %}
            {% endif %}

            {# ìµœì¢… ë³´ì •: ì„ íƒ ì‹¤íŒ¨ ì‹œ ìƒë‹¨ì—ì„œ ê³„ì‚°ëœ virustotalì„ ì¬ì‚¬ìš© #}
            {% if not vt_display and virustotal %}
              {% set vt_display = virustotal %}
            {% endif %}
            
            {% if vt_display and vt_display.scan_summary %}
              {% set scan_summary = vt_display.scan_summary %}
              {% set malicious_count = scan_summary.malicious or 0 %}
              {% set total_scans = scan_summary.total or 0 %}
              {% set detection_rate = ((scan_summary.detection_rate or ((malicious_count / total_scans * 100) if total_scans > 0 else 0))|float) %}
              
              {% if detection_rate >= 60 %}
                {% set severity_class = 'critical' %}
                {% set severity_icon = 'ğŸš¨' %}
                {% set severity_label = 'ë§¤ìš° ìœ„í—˜' %}
                {% set severity_hint = 'ì•…ì„± íŒŒì¼ì¼ ê°€ëŠ¥ì„±ì´ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤' %}
                {% set action_hint = 'ì¦‰ì‹œ íŒŒì¼ì„ ì‚­ì œí•˜ê³  ì‹œìŠ¤í…œì„ ì ê²€í•˜ì„¸ìš”. ì´ íŒŒì¼ì„ ì‹¤í–‰í•˜ì§€ ë§ˆì„¸ìš”.' %}
              {% elif detection_rate >= 30 %}
                {% set severity_class = 'danger' %}
                {% set severity_icon = 'âš ï¸' %}
                {% set severity_label = 'ìœ„í—˜' %}
                {% set severity_hint = 'ì•…ì„± íŒŒì¼ì¼ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤' %}
                {% set action_hint = 'íŒŒì¼ì„ ì‹¤í–‰í•˜ì§€ ë§ˆì‹œê³  ì‹ ì¤‘í•˜ê²Œ ê²€í† í•˜ì„¸ìš”.' %}
              {% elif detection_rate >= 10 %}
                {% set severity_class = 'warning' %}
                {% set severity_icon = 'âš¡' %}
                {% set severity_label = 'ì£¼ì˜' %}
                {% set severity_hint = 'ì¼ë¶€ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ íŠ¹ì§•ì´ ë°œê²¬ë¨' %}
                {% set action_hint = 'ì‹ ì¤‘í•˜ê²Œ ê²€í†  í›„ ì‚¬ìš©í•˜ì„¸ìš”. ê°€ëŠ¥í•˜ë©´ ë‹¤ë¥¸ ì¶œì²˜ì—ì„œ ë™ì¼í•œ íŒŒì¼ì„ í™•ì¸í•´ë³´ì„¸ìš”.' %}
              {% else %}
                {% set severity_class = 'safe' %}
                {% set severity_icon = 'âœ“' %}
                {% set severity_label = 'ì•ˆì „' %}
                {% set severity_hint = 'í˜„ì¬ê¹Œì§€ ì•…ì„±ì½”ë“œë¡œ íƒì§€ë˜ì§€ ì•ŠìŒ' %}
                {% set action_hint = 'ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.' %}
              {% endif %}
            {% else %}
              <!-- VirusTotal ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° - Empty State UI -->
              <div class="vt-empty-icon">
                <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <!-- ë°°ê²½ ë¬¸ì„œ ì•„ì´ì½˜ -->
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="#F8F9FA"/>
                  <polyline points="14,2 14,8 20,8" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  
                  <!-- ë‹ë³´ê¸° ì•„ì´ì½˜ (ë¬¸ì„œ ìœ„ì— ì˜¤ë²„ë ˆì´) -->
                  <circle cx="15" cy="12" r="5" stroke="#6B7280" stroke-width="2" fill="white"/>
                  <path d="m19 16-2.5-2.5" stroke="#6B7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  
                  <!-- X í‘œì‹œ (ë‹ë³´ê¸° ì•ˆì—) -->
                  <path d="M13 10l4 4M17 10l-4 4" stroke="#DC2626" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <h2 class="vt-empty-title">
                {% if is_archive and embedded_files and embedded_files|length > 0 %}
                  ì••ì¶• íŒŒì¼ ë‚´ë¶€ íŒŒì¼ë“¤ì˜ VirusTotal ë¶„ì„ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤
                {% else %}
                  VirusTotalì— ë“±ë¡ëœ ë¶„ì„ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤
                {% endif %}
              </h2>
              <p class="vt-empty-description">
                {% if is_archive and embedded_files and embedded_files|length > 0 %}
                  ì••ì¶• íŒŒì¼ ë‚´ë¶€ íŒŒì¼ë“¤ì´ VirusTotal ì»¤ë®¤ë‹ˆí‹°ì— ë“±ë¡ë˜ì§€ ì•Šì•„, ì•„ì§ê¹Œì§€ ì•Œë ¤ì§„ ìœ„í˜‘ì€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
                {% else %}
                  VirusTotal ì»¤ë®¤ë‹ˆí‹°ì— ë“±ë¡ëœ ë¶„ì„ ê¸°ë¡ì´ ì—†ì–´, ì•„ì§ê¹Œì§€ ì•Œë ¤ì§„ ìœ„í˜‘ì€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
                {% endif %}
              </p>
            {% endif %}
            
            {% if vt_display and (vt_display.available or vt_display.scan_summary) %}
            <!-- VirusTotal ë°ì´í„°ê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ í‘œì‹œë˜ëŠ” ê¸°ì¡´ UI -->
            <!-- ìœ„í—˜ë„ ìš”ì•½ ì¹´ë“œ -->
            <div class="vt-risk-card severity-{{ severity_class }}">
              <div class="vt-risk-header">
                <div class="vt-risk-icon">{{ severity_icon }}</div>
                <div class="vt-risk-main">
                  <div class="vt-risk-label">{{ severity_label }}</div>
                  <div class="vt-risk-score">{{ malicious_count }}/{{ total_scans }} ê°œ í”„ë¡œê·¸ë¨ì´ ìœ„í—˜í•˜ë‹¤ê³  íŒì •</div>
                </div>
                <div class="vt-risk-percentage">{{ detection_rate|round(1) }}%</div>
              </div>
              <div class="vt-risk-hint">{{ severity_hint }}</div>
              <div class="vt-action-guide">
                <strong>ê¶Œì¥ ì¡°ì¹˜:</strong> {{ action_hint }}
              </div>
            </div>

            <!-- ê²€ì‚¬ ì •ë³´ -->
            <div class="vt-info-grid">
              <div class="vt-info-item">
                <div class="vt-info-label">ê²€ì‚¬ ì—”ì§„ ìˆ˜</div>
                <div class="vt-info-value">{{ total_scans }}ê°œ</div>
                <div class="vt-info-desc">ì „ì„¸ê³„ ë³´ì•ˆ íšŒì‚¬ë“¤ì˜<br>ë°”ì´ëŸ¬ìŠ¤ ê²€ì‚¬ í”„ë¡œê·¸ë¨</div>
              </div>
              <div class="vt-info-item">
                <div class="vt-info-label">ìœ„í—˜ íƒì§€</div>
                <div class="vt-info-value severity-{{ severity_class }}">{{ malicious_count }}ê°œ</div>
                <div class="vt-info-desc">ì•…ì„±ì½”ë“œë¼ê³  íŒì •í•œ í”„ë¡œê·¸ë¨ ìˆ˜</div>
              </div>
              <div class="vt-info-item">
                <div class="vt-info-label">ìœ„í˜‘ ìœ í˜•</div>
                {% if vt_display.threat_info %}
                <div class="vt-info-value">{{ vt_display.threat_info.suggested_label or 'ì•Œ ìˆ˜ ì—†ìŒ' }}</div>
                {% else %}
                <div class="vt-info-value">ì•Œ ìˆ˜ ì—†ìŒ</div>
                {% endif %}
                <div class="vt-info-desc">ë°œê²¬ëœ ì•…ì„±ì½”ë“œì˜ ì¢…ë¥˜</div>
              </div>
              <div class="vt-info-item">
                <div class="vt-info-label">ê²€ì‚¬ ì¼ì‹œ</div>
                {% if vt_display.timestamps %}
                <div class="vt-info-value">{{ vt_display.timestamps.last_analysis or 'ì•Œ ìˆ˜ ì—†ìŒ' }}</div>
                {% else %}
                <div class="vt-info-value">ì•Œ ìˆ˜ ì—†ìŒ</div>
                {% endif %}
                <div class="vt-info-desc">ê°€ì¥ ìµœê·¼ì— ê²€ì‚¬í•œ ë‚ ì§œ</div>
              </div>
            </div>

            <!-- íƒœê·¸ ì •ë³´ -->
            <div class="vt-tags-section">
              <div class="vt-tags-label">ğŸ·ï¸ íŒŒì¼ íŠ¹ì§•</div>
              <div class="vt-tags">
                {% if vt_display.threat_info and vt_display.threat_info.tags %}
                  {% for tag in vt_display.threat_info.tags[:15] %}
                    <span class="vt-tag">{{ tag }}</span>
                  {% endfor %}
                {% else %}
                  <span class="vt-tag">íƒœê·¸ ì •ë³´ ì—†ìŒ</span>
                {% endif %}
              </div>
            </div>

            <!-- ìƒì„¸ ê²€ì‚¬ ê²°ê³¼ -->
            <div class="vt-details-section">
              <div class="vt-details-header">
                <span>ğŸ“‹ ì£¼ìš” ë³´ì•ˆ íšŒì‚¬ë³„ ê²€ì‚¬ ê²°ê³¼</span>
                <button class="vt-toggle-btn" onclick="toggleVtDetails()">ìƒì„¸ë³´ê¸°</button>
              </div>
              <div class="vt-vendor-container" id="vtVendorContainer" style="display: none;">
                <div class="vt-vendor-summary">
                  {% if vt_display.vendor_results %}
                    {% set vendors = vt_display.vendor_results %}
                    {% set bad_list = [] %}
                    {% set good_list = [] %}
                    {% for name, v in vendors.items() %}
                      {% if v.category in ['malicious','suspicious'] %}
                        {% set _ = bad_list.append({'name': name, 'result': v.result or 'íƒì§€', 'category': v.category}) %}
                      {% else %}
                        {% set _ = good_list.append({'name': name, 'result': v.result or 'ì •ìƒ', 'category': v.category or 'undetected'}) %}
                      {% endif %}
                    {% endfor %}

                    <div class="vt-vendor-group danger">
                      <div class="vt-vendor-group-title">âš ï¸ ìœ„í—˜í•˜ë‹¤ê³  íŒì •í•œ íšŒì‚¬ ({{ bad_list|length }}ê°œ)</div>
                      <div class="vt-vendor-notice">
                        <div class="vt-notice-text">ì£¼ìš” ë³´ì•ˆ íšŒì‚¬ë§Œ í‘œì‹œë©ë‹ˆë‹¤. ì „ì²´ íšŒì‚¬ì˜ ìƒì„¸ ì •ë³´ëŠ” VirusTotalì—ì„œ í™•ì¸í•˜ì„¸ìš”.</div>
                      </div>
                      <div class="vt-vendor-grid">
                        {% for item in bad_list %}
                        <div class="vt-vendor-card danger">
                          <div class="vt-vendor-header">
                            <div class="vt-vendor-name">{{ item.name }}</div>
                            <div class="vt-vendor-status danger">{{ 'ìœ„í—˜' if item.category=='malicious' else 'ì˜ì‹¬' }}</div>
                          </div>
                          <div class="vt-vendor-result">{{ item.result }}</div>
                        </div>
                        {% endfor %}
                      </div>
                    </div>

                    <div class="vt-vendor-group safe">
                      <div class="vt-vendor-group-title">âœ… ì•ˆì „/ë¯¸íƒì§€ë¡œ íŒì •í•œ íšŒì‚¬ ({{ good_list|length }}ê°œ)</div>
                      <div class="vt-vendor-notice">
                        <div class="vt-notice-text">ì£¼ìš” ë³´ì•ˆ íšŒì‚¬ë§Œ í‘œì‹œë©ë‹ˆë‹¤. ì „ì²´ íšŒì‚¬ì˜ ìƒì„¸ ì •ë³´ëŠ” VirusTotalì—ì„œ í™•ì¸í•˜ì„¸ìš”.</div>
                      </div>
                      <div class="vt-vendor-grid" id="cleanVendorList">
                        {% for item in good_list %}
                        <div class="vt-vendor-card safe">
                          <div class="vt-vendor-header">
                            <div class="vt-vendor-name">{{ item.name }}</div>
                            <div class="vt-vendor-status safe">ì•ˆì „</div>
                          </div>
                          <div class="vt-vendor-result">{{ item.result }}</div>
                        </div>
                        {% endfor %}
                      </div>
                    </div>
                  {% else %}
                    <div class="vt-vendor-group danger">
                      <div class="vt-vendor-group-title">âš ï¸ ìœ„í—˜í•˜ë‹¤ê³  íŒì •í•œ íšŒì‚¬ (0ê°œ)</div>
                      <div class="vt-vendor-grid">
                        <div class="vt-vendor-card danger">
                          <div class="vt-vendor-header">
                            <div class="vt-vendor-name">ê²€ì‚¬ ë°ì´í„° ì—†ìŒ</div>
                            <div class="vt-vendor-status danger">ìœ„í—˜</div>
                          </div>
                          <div class="vt-vendor-result">VirusTotal API í˜¸ì¶œ í•„ìš”</div>
                        </div>
                      </div>
                    </div>
                    
                    <div class="vt-vendor-group safe">
                      <div class="vt-vendor-group-title">âœ… ì•ˆì „/ë¯¸íƒì§€ë¡œ íŒì •í•œ íšŒì‚¬ (0ê°œ)</div>
                      <div class="vt-vendor-grid" id="cleanVendorList">
                        <div class="vt-vendor-card safe">
                          <div class="vt-vendor-header">
                            <div class="vt-vendor-name">ê²€ì‚¬ ë°ì´í„° ì—†ìŒ</div>
                            <div class="vt-vendor-status safe">ì•ˆì „</div>
                          </div>
                          <div class="vt-vendor-result">VirusTotal API í˜¸ì¶œ í•„ìš”</div>
                        </div>
                      </div>
                    </div>
                  {% endif %}
                </div>
              </div>
            </div>

            <!-- ì¶”ê°€ ì •ë³´ ë° ë§í¬ -->
            <div class="vt-footer-new">
              <div class="vt-learn-more">
                <strong>ğŸ’¡ Tip:</strong> VirusTotalì€ ì „ ì„¸ê³„ 70ì—¬ ê°œ ë³´ì•ˆ ì—”ì§„ìœ¼ë¡œ íŒŒì¼ì˜ ì•ˆì „ì„±ì„ êµì°¨ ê²€ì¦í•˜ëŠ” ë¬´ë£Œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.
              </div>
              <div class="vt-links">
                {% if vt_display.permalink %}
                <a href="{{ vt_display.permalink }}" target="_blank" rel="noopener" class="vt-link-btn">
                  ğŸ”— VirusTotalì—ì„œ ìì„¸íˆ ë³´ê¸°
                </a>
                {% else %}
                <a href="https://www.virustotal.com/gui/search/{{ data.sha256 }}" target="_blank" rel="noopener" class="vt-link-btn">
                  ğŸ”— VirusTotalì—ì„œ ì§ì ‘ ê²€ìƒ‰
                </a>
                {% endif %}
                {% if vt_display.timestamps %}
                <span class="vt-date-info">ìµœì´ˆ ì—…ë¡œë“œ: {{ vt_display.timestamps.first_submission or 'ì•Œ ìˆ˜ ì—†ìŒ' }}</span>
                {% else %}
                <span class="vt-date-info">VirusTotal ë°ì´í„° ì—†ìŒ</span>
                {% endif %}
              </div>
            </div>
            {% endif %}
            
          </div>
        </div>
      </div>

  {% else %}
  <div class="card">
    <h2>ë¶„ì„ ê²°ê³¼</h2>
    <div class="meta">ë¶„ì„ ê²°ê³¼ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
  </div>
  {% endif %}

  <script>

    function toggleVtDetails() {
      const container = document.getElementById('vtVendorContainer');
      const btn = document.querySelector('.vt-toggle-btn');
      
      if (container.style.display === 'none') {
        container.style.display = 'block';
        btn.textContent = 'ì ‘ê¸°';
      } else {
        container.style.display = 'none';
        btn.textContent = 'ìƒì„¸ë³´ê¸°';
      }
    }

    function toggleVtVendorDetails() {
      const container = document.getElementById('vtVendorContent');
      const btn = document.querySelector('.vt-vendor-toggle');
      
      if (container.style.display === 'none') {
        container.style.display = 'block';
        btn.textContent = 'ì ‘ê¸°';
      } else {
        container.style.display = 'none';
        btn.textContent = 'ìƒì„¸ë³´ê¸°';
      }
    }

    function showMoreVendors() {
      const cleanList = document.getElementById('cleanVendorList');
      const showMoreBtn = document.querySelector('.vt-show-more');
      
      if (cleanList.classList.contains('collapsed')) {
        cleanList.classList.remove('collapsed');
        showMoreBtn.textContent = 'ì ‘ê¸°';
      } else {
        cleanList.classList.add('collapsed');
        const hiddenCount = cleanList.querySelectorAll('.vt-vendor-item:nth-child(n+6)').length;
        showMoreBtn.textContent = `+ ${hiddenCount}ê°œ ë” ë³´ê¸°`;
      }
    }

    // ì•ˆì „ í•­ëª© í† ê¸€
    function toggleSafeItems() {
      const safeItems = document.getElementById('safe-items');
      const toggleBtn = document.querySelector('.toggle-btn');
      
      if (safeItems && toggleBtn) {
        if (safeItems.classList.contains('hidden')) {
          safeItems.classList.remove('hidden');
          toggleBtn.textContent = 'ì ‘ê¸° â–²';
        } else {
          safeItems.classList.add('hidden');
          toggleBtn.textContent = 'í¼ì³ë³´ê¸° â–¼';
        }
      }
    }
    
    // ìƒì„¸ ì •ë³´ í† ê¸€
    function toggleDetails() {
      const detailsContent = document.getElementById('detailsContent');
      const toggleBtn = document.querySelector('.details-toggle');
      
      if (detailsContent && toggleBtn) {
        if (detailsContent.style.display === 'none') {
          detailsContent.style.display = 'block';
          toggleBtn.querySelector('.toggle-text').textContent = 'ì ‘ê¸°';
          toggleBtn.querySelector('.toggle-icon').textContent = 'â–²';
        } else {
          detailsContent.style.display = 'none';
          toggleBtn.querySelector('.toggle-text').textContent = 'ë” ìì„¸íˆ ë³´ê¸°';
          toggleBtn.querySelector('.toggle-icon').textContent = 'â–¼';
        }
      }
    }
    
    // ì „ì²´ í†µê³„ í† ê¸€
    function toggleAllStats() {
      const additionalStats = document.getElementById('additional-stats');
      const toggleBtn = document.querySelector('.show-all-btn');
      
      if (additionalStats && toggleBtn) {
        if (additionalStats.classList.contains('hidden')) {
          additionalStats.classList.remove('hidden');
          toggleBtn.textContent = 'ì ‘ê¸° â–²';
        } else {
          additionalStats.classList.add('hidden');
          toggleBtn.textContent = 'ì „ì²´ í†µê³„ ë³´ê¸° â–¼';
        }
      }
    }
    
    // ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤ ì´ë™
    function scrollToSection(sectionId) {
      const element = document.getElementById(sectionId);
      if (element) {
        element.scrollIntoView({ 
          behavior: 'smooth', 
          block: 'start',
          inline: 'nearest'
        });
        
        // ì ê¹ í•˜ì´ë¼ì´íŠ¸ íš¨ê³¼
        element.style.transition = 'background-color 0.3s ease';
        element.style.backgroundColor = '#f3f4f6';
        setTimeout(() => {
          element.style.backgroundColor = '';
        }, 1000);
      }
    }
    
    // íŒŒì¼ ì‚­ì œ í•¨ìˆ˜
    function deleteFile() {
      if (confirm('ì´ íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        // ì‹¤ì œ ì‚­ì œ ë¡œì§ êµ¬í˜„
        alert('íŒŒì¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ë˜ëŠ” íŒŒì¼ ëª©ë¡ ì—…ë°ì´íŠ¸
        window.location.reload();
      }
    }
    
    // ìƒì„¸ë³´ê¸° í•¨ìˆ˜
    function viewDetails() {
      // ìƒì„¸ ì •ë³´ ëª¨ë‹¬ ë˜ëŠ” í˜ì´ì§€ë¡œ ì´ë™
      alert('ìƒì„¸ ì •ë³´ë¥¼ ë³´ì—¬ì£¼ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.');
    }

    // ë™ì  ì›í˜• í”„ë¡œê·¸ë ˆìŠ¤ ë°” ì´ˆê¸°í™” í•¨ìˆ˜
    function initializeCircularProgress() {
      const progressElements = document.querySelectorAll('.circular-progress');
      
      progressElements.forEach(function(element) {
        const percentage = parseFloat(element.getAttribute('data-percentage')) || 0;
        const fillElement = element.querySelector('.progress-ring-fill');
        
        if (fillElement) {
          // SVG í¬ê¸°ì— ë”°ë¼ ì› ë‘˜ë ˆ ê³„ì‚°
          const svgElement = element.querySelector('.progress-ring');
          const svgWidth = svgElement.getAttribute('width');
          const radius = svgWidth === '180' ? 75 : (svgWidth === '140' ? 60 : 50); // Normal: 75, Malicious: 60, ê¸°íƒ€: 50
          const circumference = 2 * Math.PI * radius;
          
          // Normal ìƒíƒœì¸ì§€ í™•ì¸ (data-percentageê°€ 0ì´ê±°ë‚˜ Normal í…ìŠ¤íŠ¸ê°€ ìˆëŠ” ê²½ìš°)
          const isNormalState = percentage === 0 || element.querySelector('.normal-status');
          
          if (isNormalState) {
            // Normal ìƒíƒœì¼ ë•ŒëŠ” ì• ë‹ˆë©”ì´ì…˜ ì—†ì´ í•­ìƒ 100% ì±„ì›Œì§„ ìƒíƒœë¡œ ê³ ì •
            fillElement.style.strokeDasharray = circumference + ' ' + circumference;
            fillElement.style.strokeDashoffset = '0';
            fillElement.style.transition = 'none'; // ì• ë‹ˆë©”ì´ì…˜ ë¹„í™œì„±í™”
          } else {
            // Malicious ìƒíƒœì¼ ë•Œë§Œ ì• ë‹ˆë©”ì´ì…˜ ì ìš©
            fillElement.style.strokeDasharray = circumference + ' ' + circumference;
            fillElement.style.strokeDashoffset = circumference;
            
            // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ë¡œ ì‹¤ì œ í¼ì„¼íŠ¸ê¹Œì§€ ì§„í–‰
            setTimeout(function() {
              const offset = circumference - (percentage / 100) * circumference;
              fillElement.style.transition = 'stroke-dashoffset 1.5s cubic-bezier(0.4, 0, 0.2, 1)';
              fillElement.style.strokeDashoffset = offset;
            }, 200);
          }
        }
      });
    }

    // íƒ­ ì „í™˜ ê¸°ëŠ¥
    function initializeTabs() {
      const tabButtons = document.querySelectorAll('.tab-button');
      const tabContents = document.querySelectorAll('.tab-content');
      
      tabButtons.forEach(button => {
        button.addEventListener('click', function() {
          const targetTab = this.getAttribute('data-tab');
          console.log('[TAB] click ->', targetTab);
          
          // ëª¨ë“  íƒ­ ë²„íŠ¼ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
          tabButtons.forEach(btn => btn.classList.remove('active'));
          // í´ë¦­ëœ íƒ­ ë²„íŠ¼ì— active í´ë˜ìŠ¤ ì¶”ê°€
          this.classList.add('active');
          
          // ëª¨ë“  íƒ­ ì½˜í…ì¸  ìˆ¨ê¸°ê¸°
          tabContents.forEach(content => {
            content.classList.remove('active');
          });
          
          // í•´ë‹¹ íƒ­ ì½˜í…ì¸  ë³´ì´ê¸°
          const targetContent = document.getElementById(targetTab + '-tab');
          if (targetContent) {
            targetContent.classList.add('active');
            console.log('[TAB] show ->', targetTab + '-tab');
          } else {
            console.warn('[TAB] target not found:', targetTab);
          }
        });
      });
    }

    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM ë¡œë“œ ì™„ë£Œ');
      try {
        const vtData = (window.__REPORT_DATA__ && window.__REPORT_DATA__.virustotal) || null;
        console.log('[VT][client] ì´ˆê¸° ë°ì´í„° ì¡´ì¬ ì—¬ë¶€:', !!vtData);
      } catch(e) {}
      
      // ì„œë²„ì—ì„œ ì „ë‹¬ëœ VT JSONì„ ë¬¸ìì—´ë¡œ ì£¼ì… í›„ íŒŒì‹± (ì—ë””í„° ë¦°íŠ¸ ì•ˆì „)
      try {
        const __vt_json = `{{ (virustotal | default(none, true)) | tojson | safe }}`;
        console.log('[DEBUG/VT/tojson]', __vt_json);
        let __vt = null;
        try { __vt = __vt_json ? JSON.parse(__vt_json) : null; } catch(e) { console.warn('parse error', e); }
        window.__REPORT_DATA__ = { virustotal: __vt };
        console.log('[REPORT] injected data', window.__REPORT_DATA__);
      } catch(e) {}
      // íƒ­ ê¸°ëŠ¥ ì´ˆê¸°í™”
      initializeTabs();
      
      // ì›í˜• ê·¸ë˜í”„ ì• ë‹ˆë©”ì´ì…˜ ì´ˆê¸°í™”
      initializeCircularProgress();
      
      
      const style = document.createElement('style');
      style.textContent = `
        .vt-vendor-list.collapsed .vt-vendor-item:nth-child(n+6) {
          display: none;
        }
        
        /* ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .analysis-section {
          margin-top: 2rem;
          background: white;
          border-radius: 12px;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
          overflow: hidden;
        }
        
        .section-header {
          background: #f8f9fa;
          border-bottom: 1px solid #e9ecef;
          padding: 20px 24px;
        }
        
        .section-header h2 {
          margin: 0;
          font-size: 18px;
          font-weight: 600;
          color: #333;
        }
        
        .section-content {
          padding: 24px;
          min-height: 200px;
        }
        
        .no-data-message {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 60px 20px;
          text-align: center;
          color: #6c757d;
        }
        
        .no-data-icon {
          font-size: 48px;
          margin-bottom: 16px;
          opacity: 0.5;
        }
        
        .no-data-text {
          font-size: 16px;
          font-weight: 500;
        }
        
        /* VirusTotal ìƒˆë¡œìš´ ë””ìì¸ ìŠ¤íƒ€ì¼ */
        .vt-new-container {
          padding: 0;
        }
        
        /* ìƒë‹¨ ìœ„í—˜ë„ ì•Œë¦¼ ì¹´ë“œ */
        .vt-danger-alert {
          background: linear-gradient(135deg, #ff4757, #ff3742);
          color: white;
          border-radius: 12px;
          padding: 24px;
          margin-bottom: 24px;
          box-shadow: 0 8px 32px rgba(255, 71, 87, 0.3);
        }
        
        .vt-danger-alert.severity-safe {
          background: linear-gradient(135deg, #2ed573, #1e90ff);
        }
        
        .vt-danger-alert.severity-warning {
          background: linear-gradient(135deg, #ffa502, #ff6348);
        }
        
        .vt-danger-alert.severity-danger {
          background: linear-gradient(135deg, #ff4757, #ff3742);
        }
        
        .vt-alert-header {
          display: flex;
          align-items: center;
          margin-bottom: 16px;
        }
        
        .vt-alert-icon {
          font-size: 32px;
          margin-right: 16px;
        }
        
        .vt-alert-main {
          flex: 1;
        }
        
        .vt-alert-title {
          font-size: 28px;
          font-weight: 700;
          margin-bottom: 8px;
        }
        
        .vt-alert-subtitle {
          font-size: 16px;
          opacity: 0.9;
        }
        
        .vt-alert-percentage {
          font-size: 24px;
          font-weight: 700;
          background: rgba(255, 255, 255, 0.2);
          padding: 8px 16px;
          border-radius: 8px;
        }
        
        .vt-alert-description {
          font-size: 16px;
          margin-bottom: 16px;
          font-weight: 500;
        }
        
        .vt-alert-action {
          font-size: 14px;
          background: rgba(255, 255, 255, 0.15);
          padding: 12px;
          border-radius: 8px;
          border-left: 4px solid rgba(255, 255, 255, 0.5);
        }
        
        /* ì¤‘ê°„ ì •ë³´ ì¹´ë“œë“¤ */
        .vt-info-cards {
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          gap: 20px;
          margin-bottom: 24px;
        }
        
        .vt-info-card {
          background: white;
          border: 1px solid #e1e8ed;
          border-radius: 12px;
          padding: 20px;
          text-align: center;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .vt-card-label {
          font-size: 14px;
          color: #657786;
          margin-bottom: 12px;
          font-weight: 500;
        }
        
        .vt-card-value {
          font-size: 32px;
          font-weight: 700;
          color: #1da1f2;
          margin-bottom: 8px;
        }
        
        .vt-card-value.vt-danger-value {
          color: #e0245e;
        }
        
        .vt-card-desc {
          font-size: 12px;
          color: #657786;
          line-height: 1.4;
        }
        
        /* íŒŒì¼ íŠ¹ì§• ì„¹ì…˜ */
        .vt-file-features {
          background: white;
          border: 1px solid #e1e8ed;
          border-radius: 12px;
          padding: 20px;
          margin-bottom: 24px;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .vt-features-header {
          display: flex;
          align-items: center;
          margin-bottom: 16px;
        }
        
        .vt-features-icon {
          font-size: 20px;
          margin-right: 8px;
        }
        
        .vt-features-title {
          font-size: 18px;
          font-weight: 600;
          color: #14171a;
        }
        
        .vt-features-tags {
          display: flex;
          flex-wrap: wrap;
          gap: 8px;
        }
        
        .vt-feature-tag {
          background: #e3f2fd;
          color: #1976d2;
          padding: 6px 12px;
          border-radius: 16px;
          font-size: 14px;
          font-weight: 500;
        }
        
        /* ë³´ì•ˆ íšŒì‚¬ë³„ ê²€ì‚¬ ê²°ê³¼ ì„¹ì…˜ */
        .vt-vendor-section {
          background: white;
          border: 1px solid #e1e8ed;
          border-radius: 12px;
          padding: 20px;
          margin-bottom: 24px;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .vt-vendor-header {
          display: flex;
          align-items: center;
          justify-content: space-between;
        }
        
        .vt-vendor-icon {
          font-size: 20px;
          margin-right: 8px;
        }
        
        .vt-vendor-title {
          font-size: 18px;
          font-weight: 600;
          color: #14171a;
          flex: 1;
        }
        
        .vt-vendor-toggle {
          background: #9c27b0;
          color: white;
          border: none;
          padding: 8px 16px;
          border-radius: 6px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          transition: background-color 0.2s ease;
        }
        
        .vt-vendor-toggle:hover {
          background: #7b1fa2;
        }
        
        .vt-vendor-content {
          margin-top: 20px;
          padding-top: 20px;
          border-top: 1px solid #e1e8ed;
        }
        
        .vt-no-vendor-data {
          text-align: center;
          color: #657786;
          font-style: italic;
          padding: 20px;
        }
        
        /* ë„ì›€ë§ ì„¹ì…˜ */
        .vt-help-section {
          background: #f3e5f5;
          border-radius: 12px;
          padding: 24px;
          margin-bottom: 24px;
        }
        
        .vt-help-content {
          max-width: none;
        }
        
        .vt-help-text {
          margin-bottom: 16px;
          color: #4a148c;
          line-height: 1.6;
        }
        
        .vt-help-actions {
          display: flex;
          align-items: center;
          justify-content: space-between;
          flex-wrap: wrap;
          gap: 12px;
        }
        
        .vt-external-link {
          background: #9c27b0;
          color: white;
          text-decoration: none;
          padding: 10px 20px;
          border-radius: 6px;
          font-weight: 500;
          transition: background-color 0.2s ease;
        }
        
        .vt-external-link:hover {
          background: #7b1fa2;
        }
        
        .vt-upload-date {
          font-size: 12px;
          color: #666;
        }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
          .section-header {
            padding: 16px 20px;
          }
          
          .section-content {
            padding: 16px 20px;
          }
          
          .vt-info-cards {
            grid-template-columns: 1fr;
            gap: 16px;
          }
          
          .vt-alert-header {
            flex-direction: column;
            text-align: center;
          }
          
          .vt-alert-icon {
            margin-right: 0;
            margin-bottom: 16px;
          }
        }
      `;
      document.head.appendChild(style);
    });
  </script>
</body>